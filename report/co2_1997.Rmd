---
title: "Global $CO_{2}$ Emissions in 1997"
short: "What Keeling missed all these years"
journal: "AER" # AER, AEJ, PP, JEL
month: "`r format(Sys.Date(), '%m')`"
year: "`r format(Sys.Date(), '%Y')`"
vol: 0
issue: 0
keywords:
  - Replication
  - Modern Science
author:
  - name: Majid Maki-Nayeri
    firstname: Maki-Nayeri
    surname: Maki-Nayeri
    email: m_maki@ischool.berkeley.edu
    affiliation: UC Berkeley, School of Information
  - name: Vinod Bakthavachalam
    firstname: Vinod
    surname: Bakthavachalam
    email: vinodb@ischool.berkeley.edu
    affiliation: UC Berkeley, School of Information
  - name: Artem Lebedev
    firstname: Artem 
    surname: Lebedev
    email: artem.lebedev@berkeley.edu
    affiliation: McMaster University, Department of Chemistry and Biochemistry
acknowledgements: | 
  The authors would like to thank their instructors from MIDS 271.
abstract: | 
  The year is 1997 and global attention is turning toward the consequences of human-actions in our environmental system. The IPCC has been in existence and studying these trends for more than ten years, and has released its second assessment report in 1995. In this report, the IPCC notes that the balance of the evidence suggests that human-actions play a role in the changing climate. Although, there is little political will to change this activity, neither have global progressive and conservative politicians broken into clear partisan camps. Here, we assess data from the Mona Loa observatory to describe and predict global $CO_{2}$ concentrations under several possible scenarios. What we find, when we run the analysis, is going to be grim.
header-includes: 
  - '\usepackage{graphicx}'
  - '\usepackage{booktabs}'
  - '\usepackage{wrapfig}'
output: rticles::aea_article
---

```{r setup, echo=FALSE}
## default to not show code, unless we ask for it.
knitr::opts_chunk$set(echo=FALSE, warning = FALSE, dpi=1000)
options(digits = 3)
```


```{r load packages, echo = FALSE, message = FALSE}
library(tidyverse)
library(tsibble)
library(latex2exp)
library(dplyr)
library(magrittr)
library(patchwork)
library(lubridate)
library(feasts)
library(forecast)
library(sandwich)
if (!"fable" %in% rownames(installed.packages())) {
  install.packages("fable")
}
library(fable)
if (!"car" %in% rownames(installed.packages())) {
  install.packages("car")
}
library(car)
theme_set(theme_minimal())
```

# Introduction

\textcolor{red}{ What is the question that you are addressing} 

\textcolor{red}{why is it worth addressing}

\textcolor{red}{What are you going to find at the completion of your analysis.}

\textcolor{blue}{Understanding a changing climate, and what it means for the earth's inhabitants is of growing interest to the scientific and policy community. Although, at this point in 1997 it is not entirely clear what the consequences of this growing awareness will be, in this report we present likely outcomes under "business-as-usual" scenarios. In doing so, our hope, is to establish a series of possible futures, and, as evidence, technology, and policy develop over the coming decades, that we can weigh the impacts that carbon-emission reduction efforts might take.}

## Carbon Emissions 
\textcolor{red}{What are are carbon emissions, and why should anyone care about them? Briefly review what is known about the relationship between the burning of fossil fuels, atmospheric $CO_{2}$}
\textcolor{red}{What is the current understanding of the linkage between atmospheric $CO_{2}$ and global average temperatures.}

# Atmospheric $CO_{2}$ Measurement and Data 
\textcolor{red}{Discuss the methods and locations for measurments of CO2.}

```{r load the data}
co2_ts <- tsibble::as_tsibble(co2)
```

```{r plot the keeling curve, echo = FALSE}
fig_1 <- co2_ts %>%
  ggplot() + 
  aes(x=index, y=value) + 
  geom_line(color = 'steelblue') +
  labs(
    x = 'Month and Year',
    y = TeX(r'($CO_2$ parts per million)')
  ) + theme(axis.text.x=element_text(size=20), 
            axis.text.y=element_text(size=20), 
           axis.title.x=element_text(size=20),
           axis.title.y=element_text(size=20),
            )

ggsave(filename = './figures/plot_1_1.pdf', plot = fig_1, device = "pdf", units = c("in"), height=5, width=10)
```

# Exploratory analysis of historical trends in atmospheric $CO_{2}$
\begingroup
\setlength{\intextsep}{12pt}
\setlength{\columnsep}{12pt}
\begin{wrapfigure}[17]{l}{0.5\textwidth}
    \centering\includegraphics[width=1\linewidth]{./figures/plot_1_1.pdf}
    \caption{Historic trend in monthly mean [$CO_2$]\label{fig:carbon}}
    \begin{figurenotes}
      $CO_2$ concentration exhibits accelerating growth, with strong seasonal oscillations. These patterns point to the need of de-seasoning and de-trending before further analysis.
    \end{figurenotes}
\end{wrapfigure}
\par
\textcolor{red}{Description how, where and why the data is generated}
\par
\textcolor{red}{Investigate the trend, seasonal and irregular elements. Trends both in levels and growth rates should be discussed}
\par
\textcolor{blue}{Atmospheric carbon is plotted in \autoref{fig:carbon}, and shows some worrying trends. Just look at how wobbly that line is. How is it possible that we are not living in a simulation, when the lines that plots monthly average $CO_{2}$ looks like this?}
\par
\endgroup

# Models and Forecasts 
\textcolor{blue}{While these plots might be compelling, it is often challenging to learn the exact nature of a time serires process from only these overview, "time vs. outcome" style of plots. In this section, we present evaluate two classes models to assess which time series model is most appropriate to use. }

## Linear and Polynomial Models 

\textcolor{red}{Fit a linear time trend model to the `co2` series, and examine the characteristics of the residuals. Compare this to a quadratic time trend model. Discuss whether a logarithmic transformation of the data would be appropriate. Fit a polynomial time trend model that incorporates seasonal dummy variables, and use this model to generate forecasts to the year 2020.}

\begin{equation}
\label{eq:one}
\text{CO}_{2} = \phi_{0} + \phi_{1}t + \epsilon_{eit}
\end{equation} 

\textcolor{red}{ writing out a model allows you to reference what models your forecasts are being generated from. We will be expecting such a declaration in your reports.}

This is a general form of a linear model, where $CO_{2}$ concentration is modeled as a linear function of time and a random error.

We estimate best fitting parameters on this model in the following way, 

```{r estimate a model, echo=TRUE}
model_lin <- lm(formula = value ~ index, data = as.data.frame(co2_ts))
```

```{r plot linear model}
as.data.frame(co2_ts) %>%
ggplot() + aes(x = index, y = value) +
  geom_point(color = "steelblue") +
  geom_line(aes(y = fitted(model_lin)), color = "red", size = 2) +
  labs(x = 'Month and Year', y = TeX(r'($CO_2$ parts per million)')) +
  theme(axis.text.x=element_text(size=20), 
        axis.text.y=element_text(size=20), 
        axis.title.x=element_text(size=20),
        axis.title.y=element_text(size=20),
        )
```


## ARIMA Models 

\textcolor{red}{Following all appropriate steps, choose an ARIMA model to fit to the series. Discuss the characteristics of your model and how you selected between alternative ARIMA specifications. Use your model (or models) to generate forecasts to the year 2022. }

```{r Split into test and train, echo = TRUE}
my_lag <- 12
co2_ts <- mutate(co2_ts, deseasoned = difference(value, lag = my_lag))
co2_ts <- mutate(co2_ts, detrended = difference(deseasoned, lag = 1))
co2_ts <- slice(co2_ts, my_lag + 2:nrow(co2_ts))
```

```{r Explore model space}
# Generate a set of models AR(1)-AR(10) and MA(1)-MA(10)
# with first and second degree of differencing.
# Select the model with the lowest BIC

model.bic <- co2_ts %>%
  model(ARIMA(deseasoned ~ 1 + pdq(1:10, 1:2, 1:10) + PDQ(0, 0, 0),
    ic = "bic",
    stepwise = F, greedy = F
  ))

# Report the winning model parameters
model.bic %>% report()
```

```{r Make final model}
hist_arima <- arima(co2_ts$value,
  order = c(1, 1, 1),
  seasonal = list(order = c(0, 1, 1), period = 12)
)
hist_arima
```
## Forecasts 

```{r test}
frcst_length <- 36
prediction_1 <- forecast(hist_arima, h=frcst_length)
```

\textcolor{red}{Generate predictions for when atmospheric CO2 is expected to be at 420 ppm and 500 ppm levels for the first and final times (consider prediction intervals as well as point estimates in your answer). Generate a prediction for atmospheric CO2 levels in the year 2100. How confident are you that these will be accurate predictions?}

# Conclusions 

\textcolor{red}{What to conclude is unclear. }

\bibliographystyle{aea}
\bibliography{references}

\appendix
\section{Appendix: Model Robustness}

\textcolor{red}{While the most plausible model that we estimate is reported in the main, "Modeling" section, in this appendix to the article we examine alternative models. Here, our intent is to provide a skeptic that does not accept our assessment of this model as an ARIMA of order (1,2,3) an understanding of model forecasts under alternative scenarios. }
